<!-- Open Content -->

<div *ngIf="productDetail$ | async as dtl">
<section class="bg-light">
  
  <div class="container pb-5">
    <div class="row">
      <div class="col-lg-5 mt-5">
        <div class="card mb-3">
          <img
            class="card-img img-fluid"
            [src]="imagePath + dtl.product.base64Image"
            [alt]="dtl.product.productName"
            id="product-detail"
          />
        </div>
        <div *ngIf="dtl.gallery?.length" class="row">
          <!--Start Controls-->
          <div class="col-1 align-self-center">
            <a href="#multi-item-example" role="button" data-bs-slide="prev">
              <i class="text-dark fas fa-chevron-right"></i>
              <span class="sr-only">قبلی</span>
            </a>
          </div>
          <!--End Controls-->
          <!--Start Carousel Wrapper-->
          <div
            id="multi-item-example"
            class="col-10 carousel slide carousel-multi-item"
            data-bs-ride="carousel"
          >
            <!--Start Slides-->
            <div class="carousel-inner product-links-wap" role="listbox">
              <!--First slide-->
              <div class="carousel-item active">
                <div class="row">
                  <div *ngFor="let galleryItem of dtl.gallery" class="col-4">
                    <a href="#">
                      <img
                        class="card-img img-fluid"
                        [src]="imageGalleryPath + galleryItem.imageName"
                        alt="dtl.product.productName"
                      />
                    </a>
                  </div>
                </div>
              </div>
              <!--/.First slide-->

              <!--Second slide-->
              <!-- <div class="carousel-item">
                <div class="row">
                  <div class="col-4">
                    <a href="#">
                      <img
                        class="card-img img-fluid"
                        src="assets/img/product_single_04.jpg"
                        alt="Product Image 4"
                      />
                    </a>
                  </div>
                </div>
              </div> -->
              <!--/.Second slide-->
            </div>
            <!--End Slides-->
          </div>
          <!--End Carousel Wrapper-->
          <!--Start Controls-->
          <div class="col-1 align-self-center">
            <a href="#multi-item-example" role="button" data-bs-slide="next">
              <i class="text-dark fas fa-chevron-left"></i>
              <span class="sr-only">بعدی</span>
            </a>
          </div>
          <!--End Controls-->
        </div>
      </div>

      <!-- col end -->
      <div class="col-lg-7 mt-5">
        <div class="card">
          <div class="card-body">
            <!-- <h1 class="h2">{{product.productName}}</h1> -->
            <h3 class="card-title">{{ dtl.product.productName }}</h3>
            <p class="h3 py-2">{{ dtl.product.price | number }} تومان</p>
            <div class="row row-cols-auto justify-content-start align-center">
              <div class="col">
                <app-rating-stars></app-rating-stars>
              </div>
              <div class="col">
                <span *ngIf="comments$ | async as comms" class="list-inline-item text-dark">
                  4.8 |
                  <!-- <a routerLink="#myTab">{{(comments$|async)?.length>0 ? (comments$|async)?.length : 'بدون ' }} نظر</a> -->
                  <!-- <a [routerLink]="['./']" fragment="comments">{{(comments$|async)?.length>0 ? (comments$|async)?.length : 'بدون ' }} نظر</a> -->
                  {{
                    comms.length > 0
                      ? comms.length
                      : "بدون "
                  }}
                  نظر
                </span>
              </div>
            </div>
            <!-- <p class="py-2">                            
                            <i class="fa fa-star text-warning"></i>
                            <i class="fa fa-star text-warning"></i>
                            <i class="fa fa-star text-warning"></i>
                            <i class="fa fa-star text-warning"></i>
                            <i class="fa fa-star text-secondary"></i> 
                            <span class="list-inline-item text-dark"> 4.8 |                                
                                {{(comments$|async)?.length>0 ? (comments$|async)?.length : 'بدون ' }} نظر
                            </span>
                        </p> -->
            <ul class="list-inline">
              <li class="list-inline-item">
                <h6>Brand:</h6>
              </li>
              <li class="list-inline-item">
                <p class="text-muted"><strong>Easy Wear</strong></p>
              </li>
            </ul>

            <h6>توضیحات:</h6>
            <p>{{ dtl.product.shortDescription }}</p>
            <ul class="list-inline">
              <li class="list-inline-item">
                <h6>Avaliable Color :</h6>
              </li>
              <li class="list-inline-item">
                <p class="text-muted"><strong>White / Black</strong></p>
              </li>
            </ul>

            <h6>مشخصات:</h6>
            <ul class="list-unstyled pb-3">
              <li>Lorem ipsum dolor sit</li>
              <li>Amet, consectetur</li>
              <li>Adipiscing elit,set</li>
            </ul>

            <!-- <input type="hidden" name="product-title" value="Activewear"> -->
            <div class="row">
              <div class="col-auto">
                <ul class="list-inline pb-3">
                  <!-- <li class="list-inline-item">Size :
                                            <input type="hidden" name="product-size" id="product-size" value="S">
                                        </li> -->
                  <li class="list-inline-item">
                    <span class="btn btn-success btn-size">S</span>
                  </li>
                  <li class="list-inline-item">
                    <span class="btn btn-success btn-size">M</span>
                  </li>
                  <li class="list-inline-item">
                    <span class="btn btn-success btn-size">L</span>
                  </li>
                  <li class="list-inline-item">
                    <span class="btn btn-success btn-size">XL</span>
                  </li>
                </ul>
              </div>

              <!-- <div class="col-auto">
                                <ul class="list-inline pb-3">
                                    <li class="list-inline-item text-right">
                                        تعداد
                                    </li>
                                    <li class="list-inline-item">
                                        <span class="btn btn-success" (click)="minusCount()">-</span>
                                    </li>
                                    <li class="list-inline-item">
                                        <input type="number" disabled [(ngModel)]="count" class="col-md-2">                                        
                                    </li>
                                    <li class="list-inline-item"><span class="btn btn-success"
                                            (click)="addCount()">+</span></li>
                                </ul>
                            </div> -->
            </div>
            <div class="row pb-3">
              <div *ngIf="!added; else addedBlock" class="col d-grid">
                <button class="btn btn-success btn-lg" (click)="addToCart()">
                  افزودن به سبد خرید
                  <i class="fa fa-cart-plus"></i>
                </button>
              </div>
              <ng-template #addedBlock>
                <div class="col d-grid">
                  <app-count-changer
                    [count]="count"
                    (countChangedEvent)="countChanged($event)"
                    (removeItemEvent)="removeItem()"
                  ></app-count-changer>
                </div>
                <div class="col-md-4 text-success fs-5 fw-bolder">
                  در سبد شما
                </div>
              </ng-template>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<!-- Close Content -->


<!-- start tab-section -->
<section  class="bg-gradient p-5">

  <!-- tab headers list -->
  <ul class="nav nav-tabs" id="myTab" role="tablist">

    <!-- description tab header -->
    <li class="nav-item" role="presentation">
      <button
        class="nav-link active"
        id="attribs-tab"
        data-bs-toggle="tab"
        data-bs-target="#attribs"
        type="button"
        role="tab"
        aria-controls="attribs"
        aria-selected="true"
      >
        مشخصات
      </button>
    </li>

    <!-- comments tab header -->
    <li class="nav-item" role="presentation">
      <button
        class="nav-link"
        id="comments-tab"
        data-bs-toggle="tab"
        data-bs-target="#comments"
        type="button"
        role="tab"
        aria-controls="comments"
        aria-selected="false"
      >
        نظرات
        ({{(comments$ | async)?.length}})
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button
        class="nav-link"
        id="contact-tab"
        data-bs-toggle="tab"
        data-bs-target="#contact"
        type="button"
        role="tab"
        aria-controls="contact"
        aria-selected="false"
      >
        Contact
      </button>
    </li>
  </ul>

  <!-- description tab data -->
  <div class="tab-content" id="myTabContent">
    <div
      class="tab-pane fade show active"
      id="attribs"
      role="tabpanel"
      aria-labelledby="attribs-tab"
    >
      {{ dtl.product.description }}
    </div>

    <!-- comments tab data -->
    <div
      class="tab-pane fade"
      id="comments"
      name="comments"
      role="tabpanel"
      aria-labelledby="comments-tab"
    >
      <div class="m-2 p-3">
        <div
          *ngFor="let comment of comments$ | async"
          class="row mb-4 pb-2 lh-1 shadow-lg"
        >
          <p class="fw-bolder">{{ comment.text }}</p>
          <div class="row">
            <div class="col-3 fs-6">{{ comment.date }}</div>
            <div class="col-2 fs-6">{{ comment.userFullName }}</div>
          </div>
        </div>
        <p *ngIf="!user">برای افزودن نظر خود ابتدا وارد حساب خود شوید</p>
        <button
          
          class="btn btn-outline-warning px-4"
          data-bs-toggle="modal"
          data-bs-target="#commentModal"
        >
          افزودن نظر
        </button>
        <!-- <ng-template #notLoggedInBlock>
                    <div class="text-danger border border-danger rounded-2 py-2 px-3">
                        برای ثبت نظر ابتدا وارد شوید
                    </div>
                </ng-template> -->
        <!-- Modal -->
        <div
          class="modal fade"
          id="commentModal"
          tabindex="-1"
          aria-labelledby="commentModalLabel"
          aria-hidden="true"
        >
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="commentModalLabel">نظر شما</h5>
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                  #commentModalClosebutton
                  aria-label="Close"
                ></button>
              </div>
              <div class="modal-body">
                <div class="mb-3">
                  <label class="col-form-label">متن :</label>
                  <textarea
                    class="form-control"
                    [(ngModel)]="commentText"
                  ></textarea>
                </div>
              </div>
              <div class="modal-footer d-grid gap-2">
                <button
                  type="button"
                  class="btn btn-primary"
                  (click)="addComment()"
                >
                  ثبت نظر
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- third tab data -->
    <div
      class="tab-pane fade"
      id="contact"
      role="tabpanel"
      aria-labelledby="contact-tab"
    >
      ...
    </div>
  </div>
</section>
<!-- end tab-section -->


<!-- Start related items carousel -->
<section *ngIf="relatedProducts$ | async as relatedPrd" class="py-5">
  <div class="container">
    <div class="row text-left p-2 pb-3">
      <h4>محصولات مشابه</h4>
    </div>
    <div
      id="carousel-related-product2"
      *ngIf="relatedPrd.length; else noRelatedBlock"
      class="d-flex flex-row mb-4"    >
      <div *ngFor="let item of relatedPrd">
        <app-product-card class="p-1 pb-3" [product]="item"></app-product-card>
      </div>
    </div>
    <ng-template #noRelatedBlock>در حال حاضر محصول مشابهی در این کتگوری موجود نیست</ng-template>
  </div>
</section>

<!-- <div class="card-group" *ngIf="relatedProducts$ | async as relatedPrd">
  <div class="card">
    <img src="..." class="card-img-top" alt="...">
    <div class="card-body">
      <h5 class="card-title">Card title</h5>
      <p class="card-text">This is a wider card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.</p>
      <p class="card-text"><small class="text-muted">Last updated 3 mins ago</small></p>
    </div>
  </div>
</div> -->

</div>
<!-- End related items carousel -->

<ngx-loading [show]="loading"></ngx-loading>


<!-- Start Slider Script -->

<!-- <script src="/src/assets/js/slick.min.js"></script> -->
<!-- <script src="/src/assets/slick/slick.js"></script> -->
<!-- <script>
  $("#carousel-related-product").slick({
    infinite: true,
    arrows: true,
    slidesToShow: 2,
    slidesToScroll: 2,
    dots: true,
    responsive: [
      {
        breakpoint: 1024,
        settings: {
          slidesToShow: 3,
          slidesToScroll: 3,
        },
      },
      {
        breakpoint: 600,
        settings: {
          slidesToShow: 2,
          slidesToScroll: 3,
        },
      },
      {
        breakpoint: 480,
        settings: {
          slidesToShow: 2,
          slidesToScroll: 3,
        },
      },
    ],
  });
</script> -->
<!-- End Slider Script -->
